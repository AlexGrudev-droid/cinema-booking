<div class="seats" id="seats-container"></div>
<script>
async function loadSeats() {
    const res = await fetch(`/api/sessions/${currentSessionId}/seats`);
    const seats = await res.json();
    const container = document.getElementById('seats-container');
    container.innerHTML = '';

    seats.forEach(seat => {
        const div = document.createElement('div');
        div.classList.add('seat');
        div.innerText = seat.number;
        
        if (seat.user) {
            if (seat.user === sessionStorage.getItem('name')) div.classList.add('own');
            else div.classList.add('booked');
            div.title = seat.user;
        }

        div.onclick = async () => {
            if (seat.user === sessionStorage.getItem('name')) {
                await fetch('/api/seats/unbook', {
                    method:'POST',
                    headers:{'Content-Type':'application/json'},
                    body:JSON.stringify({seat_id: seat.id})
                });
            } else if (!seat.user) {
                await fetch('/api/seats/book', {
                    method:'POST',
                    headers:{'Content-Type':'application/json'},
                    body:JSON.stringify({seat_id: seat.id})
                });
            } else alert('Место занято');
            loadSeats();
        };

        container.appendChild(div);
    });
}
</script>